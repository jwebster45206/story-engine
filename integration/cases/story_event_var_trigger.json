{
  "name": "Story Event Variable Trigger Test",
  "description": "Tests that story events are queued when variable conditions are met, and injected on the next turn",
  "scenario": "dracula.json",
  "seed_game_state": {
    "scene_name": "arrival",
    "user_location": "library",
    "turn_counter": 2,
    "scene_turn_counter": 2,
    "user_inventory": [
      "wooden stakes",
      "silver cross",
      "holy water"
    ],
    "vars": {
      "opened_grimoire": "false",
      "dracula_appeared": "false"
    },
    "chat_history": [
      {
        "role": "user",
        "content": "I walk through the gates and enter the castle."
      },
      {
        "role": "assistant",
        "content": "The heavy iron gates creak open as you push through them, and you step into the Grand Foyer. The oppressive atmosphere immediately envelops you - dusty portraits line the walls, their pale subjects seeming to watch your every move. An enormous chandelier draped in cobwebs hangs overhead, and the smell of decay and old blood fills your nostrils."
      },
      {
        "role": "user",
        "content": "I go east to the library."
      },
      {
        "role": "assistant",
        "content": "You make your way to the library, pushing open the heavy wooden door. Towering bookshelves reach up to the vaulted ceiling, filled with ancient tomes in Latin and other dead languages. A reading table sits in the center with several open books, their yellowed pages testament to their age. The ancient grimoire rests prominently on the table, seemingly waiting for you."
      }
    ]
  },
  "steps": [
    {
      "name": "Open grimoire (queues story event)",
      "user_prompt": "I carefully open the ancient grimoire and begin reading its forbidden knowledge.",
      "expect": {
        "scene_name": "arrival",
        "user_location": "library",
        "turn_counter": 3,
        "vars": {
          "opened_grimoire": "true"
        }
      }
    },
    {
      "name": "Dracula story event",
      "user_prompt": "WAIT_FOR_STORY_EVENT",
      "turn_counter": 4,
      "expect": {
        "story_event_contains": ["dracula"],
        "response_contains": ["dracula"]
      }
    },
    {
      "name": "No repeat of Dracula event 1",
      "user_prompt": "I clutch my silver cross tightly and prepare to face whatever comes next.",
      "expect": {
        "turn_counter": 5
      }
    },
    {
      "name": "No repeat of Dracula event 2",
      "user_prompt": "I close the grimoire and put it back on the table.",
      "expect": {
        "turn_counter": 6
      }
    }
    
  ]
}
